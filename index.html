<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#fdf2f8">
    <title>Aplikasi Hitung Gerakan Buah Hati</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Nunito:wght@700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fdf2f8; 
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            overflow-x: hidden;
        }

        /* FITUR BACKGROUND GRID MEMUDAR */
        .bg-grid-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            /* Ganti 'background.jpg' sesuai nama file fotomu */
            background-image: url('background.jpg'); 
            background-size: 150px; /* Ukuran kotak grid */
            background-repeat: repeat;
            opacity: 0.15; /* Angka 0.15 ini yang bikin efek memudar */
            pointer-events: none;
        }

        .heading-font { font-family: 'Nunito', sans-serif; }
        .kick-button:active { transform: scale(0.95); }
        .progress-ring { transition: stroke-dashoffset 0.35s; transform: rotate(-90deg); transform-origin: 50% 50%; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

    <div class="bg-grid-overlay"></div>

    <audio id="bg-music" src="musik.mp3" loop></audio>

    <header class="w-full max-w-md text-center mb-6 mt-4">
        <h1 class="heading-font text-2xl text-pink-600 font-bold">Aplikasi Hitung Gerakan Buah Hati</h1>
        <p class="text-gray-500 text-sm">Pantau aktivitas janin setiap hari</p>
    </header>

    <main class="w-full max-w-md bg-white/90 backdrop-blur-sm rounded-3xl p-6 shadow-xl relative mb-6">
        <div class="flex justify-between items-center mb-6">
            <span id="session-status" class="bg-pink-100 text-pink-600 text-xs font-bold px-3 py-1 rounded-full uppercase">Sesi Belum Dimulai</span>
            <div class="text-right">
                <p class="text-gray-400 text-xs uppercase">Durasi</p>
                <p id="timer-display" class="font-mono font-bold text-gray-700">00:00:00</p>
            </div>
        </div>

        <div class="relative flex justify-center items-center mb-8">
            <svg width="200" height="200">
                <circle class="text-gray-100" stroke-width="12" stroke="currentColor" fill="transparent" r="85" cx="100" cy="100"/>
                <circle id="progress-bar" class="text-pink-500 progress-ring" stroke-width="12" stroke-dasharray="534" stroke-dashoffset="0" stroke-linecap="round" stroke="currentColor" fill="transparent" r="85" cx="100" cy="100"/>
            </svg>
            <div class="absolute inset-0 flex flex-col justify-center items-center">
                <span id="kick-count" class="heading-font text-6xl text-pink-600">0</span>
                <span class="text-gray-400 font-semibold uppercase text-xs">Gerakan</span>
            </div>
        </div>

        <div class="grid grid-cols-1 gap-4">
            <button id="btn-kick" class="w-full bg-pink-500 text-white py-6 rounded-2xl text-xl font-bold shadow-lg disabled:opacity-50" disabled>HITUNG GERAKAN</button>
            
            <div class="flex space-x-3">
                <button id="btn-start" class="flex-1 bg-green-500 text-white py-3 rounded-xl font-bold shadow-md">MULAI SESI</button>
                <button id="btn-stop" class="flex-1 bg-gray-200 text-gray-600 py-3 rounded-xl font-bold hidden">SELESAI</button>
                <button id="btn-reset" class="flex-1 bg-red-100 text-red-600 py-3 rounded-xl font-bold">RESET</button>
            </div>
        </div>
    </main>

    <section class="w-full max-w-md">
        <div class="flex justify-between items-center mb-3 px-2">
            <h2 class="heading-font text-lg text-gray-700">Riwayat Terakhir</h2>
            <button id="btn-clear-history" class="text-xs text-gray-400 hover:text-red-500">Hapus Semua</button>
        </div>
        <div id="history-list" class="space-y-3"></div>
    </section>

    <div class="w-full max-w-md mt-8 p-4 bg-blue-50 border border-blue-100 rounded-2xl text-blue-800 text-xs">
        <p class="font-bold mb-1">ðŸ’¡ Tips Aplikasi Hitung Gerakan Buah Hati:</p>
        <p>Gunakan aplikasi ini untuk memantau pola gerakan bayi secara rutin. Jika gerakan berkurang drastis, segera konsultasikan ke dokter kandungan Anda.</p>
    </div>

    <script>
        const kickDisplay = document.getElementById('kick-count');
        const timerDisplay = document.getElementById('timer-display');
        const statusDisplay = document.getElementById('session-status');
        const historyList = document.getElementById('history-list');
        const bgMusic = document.getElementById('bg-music');
        
        const btnKick = document.getElementById('btn-kick');
        const btnStart = document.getElementById('btn-start');
        const btnStop = document.getElementById('btn-stop');
        const btnReset = document.getElementById('btn-reset');
        const btnClear = document.getElementById('btn-clear-history');

        let count = 0, startTime = null, timerInterval = null, isRunning = false;

        function updateTimer() {
            const now = new Date();
            const diff = new Date(now - startTime);
            const h = String(diff.getUTCHours()).padStart(2, '0');
            const m = String(diff.getUTCMinutes()).padStart(2, '0');
            const s = String(diff.getUTCSeconds()).padStart(2, '0');
            timerDisplay.textContent = `${h}:${m}:${s}`;
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('kick_history') || '[]');
            historyList.innerHTML = history.length ? history.reverse().map(item => `
                <div class="bg-white p-4 rounded-2xl shadow-sm flex justify-between items-center border-l-4 border-pink-400">
                    <div>
                        <p class="font-bold text-gray-700">${item.count} Gerakan</p>
                        <p class="text-[10px] text-gray-400 uppercase font-semibold">${item.date} â€¢ ${item.time}</p>
                    </div>
                    <p class="text-xs text-gray-500 font-mono">${item.duration}</p>
                </div>`).join('') : '<div class="text-center py-8 text-gray-400 italic text-sm">Belum ada riwayat.</div>';
        }

        btnStart.addEventListener('click', () => {
            isRunning = true;
            count = 0;
            kickDisplay.textContent = '0';
            startTime = new Date();
            timerInterval = setInterval(updateTimer, 1000);
            
            // Putar Musik saat klik Mulai
            bgMusic.play().catch(e => console.log("Musik diblokir browser, butuh interaksi user."));
            
            btnStart.classList.add('hidden');
            btnStop.classList.remove('hidden');
            btnKick.disabled = false;
            statusDisplay.textContent = 'Sesi Berjalan';
            statusDisplay.className = 'bg-green-100 text-green-600 text-xs font-bold px-3 py-1 rounded-full uppercase';
        });

        btnKick.addEventListener('click', () => {
            if (!isRunning) return;
            count++;
            kickDisplay.textContent = count;
            if (window.navigator.vibrate) window.navigator.vibrate(50);
        });

        btnStop.addEventListener('click', () => {
            clearInterval(timerInterval);
            isRunning = false;
            bgMusic.pause(); // Matikan musik saat selesai
            bgMusic.currentTime = 0;
            
            const now = new Date();
            const history = JSON.parse(localStorage.getItem('kick_history') || '[]');
            history.push({
                count: count,
                duration: timerDisplay.textContent,
                date: now.toLocaleDateString('id-ID', { day: 'numeric', month: 'short' }),
                time: now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })
            });
            localStorage.setItem('kick_history', JSON.stringify(history));
            
            loadHistory();
            btnStop.classList.add('hidden');
            btnStart.classList.remove('hidden');
            btnKick.disabled = true;
            statusDisplay.textContent = 'Sesi Selesai';
        });

        btnReset.addEventListener('click', () => {
            if (confirm('Reset hitungan dan waktu sekarang?')) {
                location.reload();
            }
        });

        btnClear.addEventListener('click', () => {
            if (confirm('Hapus semua riwayat?')) {
                localStorage.removeItem('kick_history');
                loadHistory();
            }
        });

        loadHistory();
    </script>
</body>
</html>